!function(e,n){function a(e){for(var n=["B","KB","MB","GB","TB","PB"],a=0;e>=1204;)e/=1024,a++;return e.toFixed(2)+" "+n[a]}var r=function(n){var r,o={url:null,maxSize:5,auto:!0,multiple:!0,allowExt:["jpg","png","gif"],beforeSend:e.noop,success:e.noop,error:e.noop,onprogress:null,data:null,processbar:!1,dataType:"json",processContainer:null,startBtn:null};r=e.extend(o,n);var t=(268435456*(1+Math.random())|0).toString(16),i="uploadfile-"+t,s=r.multiple?' multiple="multiple" ':"";e("body").append('<input id="'+i+'" type="file" '+s+' style="display:none">');var l=e("#"+i);e(this).on("click",function(){l.trigger("click")}),l.on("change",function(){var e=this.files;e.length>0?p(e):console.log("no file selected")});var p=function(n){var a=new FormData,o=[],t=1048576*r.maxSize,i=!1,s=!1,l=[];return e.each(n,function(n,p){p.size>t&&(i=p.name+"超过"+r.maxSize+"MB,无法上传!");var c=p.name.split(".");(c.length<2||e.inArray(c.pop().toLowerCase(),r.allowExt)<0)&&(s=p.name+"文件类型不允许!");var u="file"+n;o.push(u),a.append(u,p),l.push(p.size)}),i?alert(i):s?alert(s):(a.append("filelist",o),a.append("data",JSON.stringify(r.data)),r.beforeSend(a),r.processbar&&u(n),r.auto?c(a,l):void e(r.startBtn).off("click").one("click",function(){c(a,l)}))},c=function(n,a){var o={url:r.url,cache:!1,contentType:!1,processData:!1,type:"POST",dataType:r.dataType,data:n,xhr:function(){var n=e.ajaxSettings.xhr();return n.upload.onprogress=function(n){if(e.isFunction(r.onprogress))return r.onprogress(n,a);var o=n.loaded;if(!r.processbar)return console.log("process "+Math.floor(o/n.total*100)+"%");var t=e(r.processContainer);for(var i in a){var s=a[i];if(!(o>s)){var l=Math.floor(o/s*100)+"%";t.find(".process-"+i+" i").animate({width:l},5);break}o-=s,t.find(".process-"+i+" i").animate({width:"100%"},5)}},n},success:r.success,error:r.error};e.ajax(o)},u=function(n){var o=[];e.each(n,function(e,n){o.push('<div><p class="filename file-'+e+' ">'+n.name+"("+a(n.size)+')</p><p class="processbar process-'+e+'"><i></i></p></div>')}),e(r.processContainer).html(o.join(""))}};e.fn.uploadFile=r}(jQuery,window);