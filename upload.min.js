!function(e,o){function n(e){for(var o=["B","KB","MB","GB","TB","PB"],n=0;e>=1204;)e/=1024,n++;return e.toFixed(2)+" "+o[n]}var a=function(o){var a,r,t,i={url:null,maxSize:5,auto:!0,multiple:!0,allowExt:["jpg","png","gif"],before:e.noop,success:e.noop,error:e.noop,onprogress:null,data:null,processbar:!1,dataType:"json",processContainer:null,startBtn:null,always:e.noop,destroy:!1};a=e.extend(i,o);var s=(268435456*(1+Math.random())|0).toString(16),l="uploadfile-"+s,p=a.multiple?' multiple="multiple" ':"";e("body").append('<input id="'+l+'" type="file" '+p+' style="display:none">');var c=e("#"+l),u=e(this);t=function(){c.trigger("click")},u.on("click",t),c.on("change",function(){var e=this.files;e.length>0?f(e):console.log("no file selected")});var f=function(o){var n=new FormData,t=[],i=1048576*a.maxSize,s=!1,l=!1,p=[];return e.each(o,function(o,r){r.size>i&&(s=r.name+"超过"+a.maxSize+"MB,无法上传!");var c=r.name.split(".");(c.length<2||e.inArray(c.pop().toLowerCase(),a.allowExt)<0)&&(l=r.name+"文件类型不允许!");var u="file"+o;t.push(u),n.append(u,r),p.push(r.size)}),s?alert(s):l?alert(l):(n.append("filelist",t),a.before(a),n.append("data",JSON.stringify(a.data)),a.processbar&&v(o),r=function(){d(n,p)},a.auto?d(n,p):void e(a.startBtn).off("click",r).on("click",r))},d=function(o,n){c.val("");var i={url:a.url,cache:!1,contentType:!1,processData:!1,type:"POST",dataType:a.dataType,data:o,xhr:function(){var o=e.ajaxSettings.xhr();return o.upload.onprogress=function(o){if(e.isFunction(a.onprogress))return a.onprogress(o,n);var r=o.loaded;if(!a.processbar)return console.log("process "+Math.floor(r/o.total*100)+"%");var t=e(a.processContainer);for(var i in n){var s=n[i];if(!(r>s)){var l=Math.floor(r/s*100)+"%";t.find(".process-"+i+" i").animate({width:l},5);break}r-=s,t.find(".process-"+i+" i").animate({width:"100%"},5)}},o},success:a.success,error:a.error},s=a.destroy?function(){c.remove(),a.processbar&&e(a.processContainer).empty(),u.off("click",t),e(a.startBtn).off("click",r)}:e.noop;e.ajax(i).always(a.always).done(s)},v=function(o){var r=[];e.each(o,function(e,o){r.push('<div><p class="filename file-'+e+' ">'+o.name+"("+n(o.size)+')</p><p class="processbar process-'+e+'"><i></i></p></div>')}),e(a.processContainer).html(r.join(""))}};e.fn.uploadFile=a}(jQuery,window);