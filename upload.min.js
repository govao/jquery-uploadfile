!function(e,n){function o(e){for(var n=["B","KB","MB","GB","TB","PB"],o=0;e>=1204;)e/=1024,o++;return e.toFixed(2)+" "+n[o]}var a=function(n){var a,r,t,i={url:null,maxSize:5,auto:!0,multiple:!0,allowExt:["jpg","png","gif"],before:e.noop,success:e.noop,error:e.noop,onprogress:null,data:null,processbar:!1,dataType:"json",processContainer:null,startBtn:null,destroy:!1};a=e.extend(i,n);var s=(268435456*(1+Math.random())|0).toString(16),l="uploadfile-"+s,c=a.multiple?' multiple="multiple" ':"";e("body").append('<input id="'+l+'" type="file" '+c+' style="display:none">');var p=e("#"+l),u=e(this);t=function(){p.trigger("click")},u.on("click",t),p.on("change",function(){var e=this.files;e.length>0?f(e):console.log("no file selected")});var f=function(n){var o=new FormData,t=[],i=1048576*a.maxSize,s=!1,l=!1,c=[];return e.each(n,function(n,r){r.size>i&&(s=r.name+"超过"+a.maxSize+"MB,无法上传!");var p=r.name.split(".");(p.length<2||e.inArray(p.pop().toLowerCase(),a.allowExt)<0)&&(l=r.name+"文件类型不允许!");var u="file"+n;t.push(u),o.append(u,r),c.push(r.size)}),s?alert(s):l?alert(l):(o.append("filelist",t),a.before(a),o.append("data",JSON.stringify(a.data)),a.processbar&&v(n),r=function(){d(o,c)},a.auto?d(o,c):void e(a.startBtn).off("click",r).on("click",r))},d=function(n,o){p.val("");var i={url:a.url,cache:!1,contentType:!1,processData:!1,type:"POST",dataType:a.dataType,data:n,xhr:function(){var n=e.ajaxSettings.xhr();return n.upload.onprogress=function(n){if(e.isFunction(a.onprogress))return a.onprogress(n,o);var r=n.loaded;if(!a.processbar)return console.log("process "+Math.floor(r/n.total*100)+"%");var t=e(a.processContainer);for(var i in o){var s=o[i];if(!(r>s)){var l=Math.floor(r/s*100)+"%";t.find(".process-"+i+" i").animate({width:l},5);break}r-=s,t.find(".process-"+i+" i").animate({width:"100%"},5)}},n},success:a.success,error:a.error},s=a.destroy?function(){p.remove(),a.processbar&&e(a.processContainer).empty(),u.off("click",t),e(a.startBtn).off("click",r)}:e.noop;e.ajax(i).always(a.always).done(s)},v=function(n){var r=[];e.each(n,function(e,n){r.push('<div><p class="filename file-'+e+' ">'+n.name+"("+o(n.size)+')</p><p class="processbar process-'+e+'"><i></i></p></div>')}),e(a.processContainer).html(r.join(""))}};e.fn.uploadFile=a}(jQuery,window);